<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        // Immediate theme detection before any content loads
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('calcite-mode-dark');
        }
    </script>

    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JWEC - Fiber & Electric Outage Map</title>
    <meta name="description" content="Real-time fiber and electric outage tracking map for JWEC service area" />

    <!-- Calcite Components CSS -->
    <link rel="stylesheet" href="https://js.arcgis.com/calcite-components/3.2.1/calcite.css" />

    <!-- ArcGIS CSS - Theme will be set by JavaScript -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" data-theme="light"
        media="(prefers-color-scheme: light)" />
    <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/dark/main.css" data-theme="dark"
        media="(prefers-color-scheme: dark)" />

    <style>
        /* Critical theme styles that must load before content */
        :root {
            --status-text-color: var(--calcite-color-text-2);
        }

        .calcite-mode-dark {
            color-scheme: dark;
        }

        /* Immediate theme-aware styles */
        .status-counter {
            color: var(--calcite-color-text-2);
        }

        /* Loading state colors */
        .status-counter.loading {
            background-color: var(--calcite-color-foreground-2);
            border: 1px solid var(--calcite-color-border-2);
        }

        /* Status colors */
        .status-counter.danger:not(.loading) {
            background-color: var(--calcite-color-status-danger);
            color: var(--calcite-color-text-inverse);
        }

        .status-counter.warning:not(.loading) {
            background-color: var(--calcite-color-status-warning);
            color: var(--calcite-color-text-1);
        }
    </style>
</head>

<body>
    <!-- Main App Container -->
    <div id="app">
        <!-- Calcite Shell for layout -->
        <calcite-shell>
            <!-- Header Panel with Counter -->
            <div slot="header" class="app-header">
                <div class="header-content">
                    <!-- Left Logo Section -->
                    <div class="header-logos">
                        <div class="header-logo">
                            <img id="tenant-logo" src="/logos/freedomfiber-logo.png" alt="Freedom Fiber Symbol">
                        </div>
                        <div class="header-logo">
                            <img id="tenant-text-logo" src="/logos/freedomfiber-text-logo.png" alt="Freedom Fiber">
                        </div>
                    </div>

                    <!-- Counter Section -->
                    <div class="counter-chips">
                        <div id="fiber-counter" class="status-counter danger loading">
                            <span id="fiber-count">0</span>
                        </div>
                        <div id="electric-counter" class="status-counter warning loading" style="display: none;">
                            <span id="electric-count">0</span>
                        </div>
                    </div>

                    <!-- Right Logo Section (invisible, for balance) -->
                    <div class="header-logos"></div>
                </div>
                <calcite-loader id="loading-indicator" active></calcite-loader>
            </div>

            <!-- Map Container -->
            <div id="map-container">
                <div id="map"></div>

                <!-- Search Widget Container -->
                <div id="search-container"></div>
            </div>

            <!-- Action Bar for Controls -->
            <calcite-action-bar slot="action-bar">
                <calcite-action id="home-action" text="Home" icon="home"></calcite-action>
                <calcite-action id="locate-action" text="My Location" icon="gps-on"></calcite-action>
                <calcite-action id="refresh-action" text="Refresh Data" icon="refresh"></calcite-action>
                <calcite-action id="layers-action" text="Toggle Layers" icon="layers"></calcite-action>
            </calcite-action-bar>

            <!-- Layer Toggle Panel (hidden by default) -->
            <calcite-shell-panel slot="panel-end" id="layers-panel" hidden>
                <calcite-panel heading="Map Layers">
                    <calcite-block expanded heading="Data Layers" description="Toggle layer visibility">
                        <calcite-label layout="inline">
                            <calcite-checkbox id="fiber-toggle" checked></calcite-checkbox>
                            Fiber Offline Points
                        </calcite-label>
                        <calcite-label layout="inline">
                            <calcite-checkbox id="electric-toggle" checked></calcite-checkbox>
                            Power Outage Points
                        </calcite-label>
                    </calcite-block>

                    <calcite-block expanded heading="Basemap" description="Choose map style">
                        <calcite-radio-button-group id="basemap-group" name="basemap">
                            <calcite-label layout="inline">
                                <calcite-radio-button value="streets-navigation-vector" checked></calcite-radio-button>
                                Streets
                            </calcite-label>
                            <calcite-label layout="inline">
                                <calcite-radio-button value="satellite"></calcite-radio-button>
                                Satellite
                            </calcite-label>
                            <calcite-label layout="inline">
                                <calcite-radio-button value="hybrid"></calcite-radio-button>
                                Hybrid
                            </calcite-label>
                            <calcite-label layout="inline">
                                <calcite-radio-button value="dark-gray-vector"></calcite-radio-button>
                                Dark
                            </calcite-label>
                        </calcite-radio-button-group>
                    </calcite-block>
                </calcite-panel>
            </calcite-shell-panel>
        </calcite-shell>

        <!-- Status Toast -->
        <calcite-alert id="status-alert" placement="bottom" auto-close auto-close-duration="fast" hidden>
            <div slot="title">Status Update</div>
            <div slot="message" id="alert-message"></div>
        </calcite-alert>
    </div>

    <!-- Load main application script -->
    <script type="module" src="/src/main.js"></script>
</body>

</html>